variables:
  NUGET_PACKAGES: $(Pipeline.Workspace)/.nuget/packages

schedules:
- cron: 0 0 * * Wed
  displayName: Weekly build (patching)
  branches:
    include:
    - main
  always: true

trigger:
- main

name: '$(Date:%y).$(DayOfYear).$(Rev:r)'

stages:

- stage: Build
  jobs:
  - template: jobs/build.yml

- stage: Deploy_PreReq
  dependsOn: Build
  displayName: Deploy Prerequisites
  jobs:
  - deployment: Deploy_AppInsights
    displayName: Deploy AppInsights
    environment: ns-prod
    pool:
      vmImage: windows-latest
    strategy:
      runOnce:
        deploy:
          steps:
          - task: PowerShell@2
            displayName: Test
            inputs:
              targetType: inline
              script: Write-Host 'Hello world!'
